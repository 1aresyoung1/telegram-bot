import os
import logging
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    filters,
)

# ================== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ==================
TOKEN = os.getenv("8596592294:AAHvoj-GVwfToT103XWOcvMMUoqE2DrkflU")

logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)

# ================== –°–¢–ê–ù–ò –ö–û–†–ò–°–¢–£–í–ê–ß–ê ==================
MODE_NONE = "none"
MODE_HELP = "help"
MODE_SUGGEST = "suggest"

user_modes = {}

# ================== –ö–ù–û–ü–ö–ò ==================
MAIN_KEYBOARD = ReplyKeyboardMarkup(
    [
        ["üîê –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Ä–æ–ª—å", "üîó –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è"],
        ["üé≤ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å", "üõ° –ü–æ—Ä–∞–¥–∏ –∑ –±–µ–∑–ø–µ–∫–∏"],
        ["‚ÑπÔ∏è –ü—Ä–æ –±–æ—Ç–∞", "üÜò –î–æ–ø–æ–º–æ–≥–∞"],
        ["üí° –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è"],
    ],
    resize_keyboard=True,
)

# ================== START ==================
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_modes[update.effective_user.id] = MODE_NONE
    await update.message.reply_text(
        "üëã –ü—Ä–∏–≤—ñ—Ç!\n\n"
        "–Ø –±–æ—Ç –∑ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ–∫–∏ üîê\n"
        "–î–æ–ø–æ–º–æ–∂—É –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Ä–æ–ª—ñ, –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏.\n\n"
        "‚¨áÔ∏è –û–±–µ—Ä–∏ –¥—ñ—é –∑ –º–µ–Ω—é:",
        reply_markup=MAIN_KEYBOARD,
    )

# ================== –û–ë–†–û–ë–ö–ê –ö–ù–û–ü–û–ö ==================
async def handle_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    user_id = update.effective_user.id

    # ---------- –ü–ï–†–ï–í–Ü–†–ö–ê –ü–ê–†–û–õ–Ø ----------
    if text == "üîê –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–∞—Ä–æ–ª—å":
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "üîê –ù–∞–¥—ñ—à–ª–∏ –ø–∞—Ä–æ–ª—å.\n"
            "–Ø –æ—Ü—ñ–Ω–∏–º –π–æ–≥–æ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å."
        )
        return

    # ---------- –ü–ï–†–ï–í–Ü–†–ö–ê –ü–û–°–ò–õ–ê–ù–ù–Ø ----------
    if text == "üîó –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è":
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "üîó –ù–∞–¥—ñ—à–ª–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.\n"
            "–Ø –ø–µ—Ä–µ–≤—ñ—Ä—é, —á–∏ –≤–æ–Ω–æ –º–æ–∂–µ –±—É—Ç–∏ —Ñ—ñ—à–∏–Ω–≥–æ–≤–∏–º."
        )
        return

    # ---------- –ì–ï–ù–ï–†–ê–¶–Ü–Ø –ü–ê–†–û–õ–Ø ----------
    if text == "üé≤ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å":
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "üé≤ –ù–∞–¥—ñ–π–Ω–∏–π –ø–∞—Ä–æ–ª—å:\n\n"
            "`Q9!f@A7Lm#2X`",
            parse_mode="Markdown",
        )
        return

    # ---------- –ü–û–†–ê–î–ò ----------
    if text == "üõ° –ü–æ—Ä–∞–¥–∏ –∑ –±–µ–∑–ø–µ–∫–∏":
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "üõ° –û—Å–Ω–æ–≤–Ω—ñ –ø–æ—Ä–∞–¥–∏:\n\n"
            "‚Ä¢ –ù–µ –ø–µ—Ä–µ—Ö–æ–¥—å –∑–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏\n"
            "‚Ä¢ –ù–µ –≤–≤–æ–¥—å –∫–æ–¥–∏ –∑ SMS\n"
            "‚Ä¢ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ä—ñ–∑–Ω—ñ –ø–∞—Ä–æ–ª—ñ\n"
            "‚Ä¢ –£–≤—ñ–º–∫–Ω–∏ 2FA"
        )
        return

    # ---------- –ü–†–û –ë–û–¢–ê ----------
    if text == "‚ÑπÔ∏è –ü—Ä–æ –±–æ—Ç–∞":
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "‚ÑπÔ∏è –¶–µ–π –±–æ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –¥–æ–ø–æ–º–æ–≥–∏ –∑ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ–∫–∏.\n\n"
            "–í—ñ–Ω –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î —Ç–≤–æ—ó –¥–∞–Ω—ñ —Ç–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç—Ä–µ—Ç—ñ–º –æ—Å–æ–±–∞–º."
        )
        return

    # ---------- –î–û–ü–û–ú–û–ì–ê ----------
    if text == "üÜò –î–æ–ø–æ–º–æ–≥–∞":
        user_modes[user_id] = MODE_HELP
        await update.message.reply_text(
            "üÜò –û–ø–∏—à–∏ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É **–æ–¥–Ω–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º**.\n"
            "–Ø —Å–ø—Ä–æ–±—É—é –¥–æ–ø–æ–º–æ–≥—Ç–∏ ü§ñ"
        )
        return

    # ---------- –ü–†–û–ü–û–ó–ò–¶–Ü–á ----------
    if text == "üí° –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è":
        user_modes[user_id] = MODE_SUGGEST
        await update.message.reply_text(
            "üí° –ù–∞–ø–∏—à–∏ —Å–≤–æ—é –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é –∞–±–æ —ñ–¥–µ—é –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –±–æ—Ç–∞.\n"
            "–í–æ–Ω–∞ –±—É–¥–µ –≤—Ä–∞—Ö–æ–≤–∞–Ω–∞ üöÄ"
        )
        return

    # ---------- –û–ë–†–û–ë–ö–ê –¢–ï–ö–°–¢–£ ----------
    mode = user_modes.get(user_id, MODE_NONE)

    if mode == MODE_HELP:
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(ai_help_answer(text))
        return

    if mode == MODE_SUGGEST:
        user_modes[user_id] = MODE_NONE
        await update.message.reply_text(
            "‚úÖ –î—è–∫—É—é!\n"
            "–¢–≤–æ—è –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞ —ñ –±—É–¥–µ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∞ üôå"
        )
        return

    # ---------- –ó–ê–•–ò–°–¢ –í–Ü–î –°–ú–Ü–¢–¢–Ø ----------
    await update.message.reply_text(
        "‚ÑπÔ∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –∫–æ—Ä–∏—Å—Ç—É–π—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ –º–µ–Ω—é ‚¨áÔ∏è",
        reply_markup=MAIN_KEYBOARD,
    )

# ================== –õ–û–ö–ê–õ–¨–ù–ò–ô –®–Ü ==================
def ai_help_answer(problem: str) -> str:
    p = problem.lower()

    if any(word in p for word in ["–∑–ª–∞–º", "–≤–∫—Ä–∞–ª–∏", "—Ö–∞–∫"]):
        return (
            "üö® –ú–æ–∂–ª–∏–≤–∏–π –∑–ª–∞–º!\n\n"
            "–©–æ —Ä–æ–±–∏—Ç–∏:\n"
            "‚Ä¢ –¢–µ—Ä–º—ñ–Ω–æ–≤–æ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—ñ\n"
            "‚Ä¢ –í–∏–π—Ç–∏ –∑ —É—Å—ñ—Ö —Å–µ—Å—ñ–π\n"
            "‚Ä¢ –£–≤—ñ–º–∫–Ω—É—Ç–∏ 2FA\n"
            "‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –∞–Ω—Ç–∏–≤—ñ—Ä—É—Å–æ–º"
        )

    if any(word in p for word in ["–ø–æ—Å–∏–ª–∞–Ω–Ω—è", "—Å–∞–π—Ç", "—Ñ—ñ—à–∏–Ω–≥"]):
        return (
            "üîó –°—Ö–æ–∂–µ –Ω–∞ —Ñ—ñ—à–∏–Ω–≥.\n\n"
            "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:\n"
            "‚Ä¢ –ù–µ –≤–≤–æ–¥—å –¥–∞–Ω—ñ\n"
            "‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä –¥–æ–º–µ–Ω\n"
            "‚Ä¢ –Ü–≥–Ω–æ—Ä—É–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"
        )

    if "–ø–∞—Ä–æ–ª—å" in p:
        return (
            "üîê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–∞—Ä–æ–ª—è:\n\n"
            "‚Ä¢ 12‚Äì16 —Å–∏–º–≤–æ–ª—ñ–≤\n"
            "‚Ä¢ –í–µ–ª–∏–∫—ñ –π –º–∞–ª—ñ –ª—ñ—Ç–µ—Ä–∏\n"
            "‚Ä¢ –¶–∏—Ñ—Ä–∏ —Ç–∞ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∏\n"
            "‚Ä¢ –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–∞–π—Ç—É"
        )

    return (
        "ü§ñ –Ø –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.\n\n"
        "–†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –æ—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ —Ç–∞ –¥—ñ—è—Ç–∏ –æ–±–µ—Ä–µ–∂–Ω–æ.\n"
        "–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ ‚Äî —É—Ç–æ—á–Ω–∏ –¥–µ—Ç–∞–ª—ñ."
    )

# ================== –ó–ê–ü–£–°–ö ==================
def main():
    app = Application.builder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_menu))

    app.run_polling()

if __name__ == "__main__":
    main()
